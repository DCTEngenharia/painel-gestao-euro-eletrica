<style>
  .painel {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 20px 40px;
    gap: 30px;
  }

  .bloco-indicadores {
    display: flex;
    flex-direction: column;
    gap: 18px;
  }

  .indicadores {
    display: flex;
    flex-wrap: wrap;
    gap: 14px;
  }

  .bloco-graficos {
    background: #ffffff;
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    gap: 34px;
  }

  .grafico-container {
    position: relative;
    width: 180px;
    height: 200px;
  }
</style>

<div class="painel">
  <div class="bloco-indicadores">
    <div class="indicadores" id="indicadoresResumo"></div>
    <div class="indicadores" id="indicadoresEurofarma"></div>
  </div>

  <div class="bloco-graficos">
    <div class="grafico-container">
      <div class="grafico-titulo">Distribui√ß√£o por Status</div>
      <canvas id="graficoStatus"></canvas>
      <div class="grafico-label" id="labelStatus">0%</div>
    </div>
    <div class="grafico-container">
      <div class="grafico-titulo">Projetos em Andamento</div>
      <canvas id="graficoAndamento"></canvas>
      <div class="grafico-label" id="labelAndamento">0%</div>
    </div>
  </div>
</div>
  <script>
    const planilhaCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTeKHP3NBrjWs7vY3PRYZAsaQ4hY0cZwHl3SbzkH6GOgeVeBxFHhZj1io0-U4Vx3Su9FRFmjwI7NIxW/pub?output=csv";

    function processaDados(data) {
      const container = document.getElementById("indicadoresResumo");
      container.innerHTML = "";
      let totalProjetos = data.length;
      let andamento = 0;
      let contagemStatus = {};

      data.forEach(row => {
        if (row.Status) {
          const status = row.Status.trim();
          contagemStatus[status] = (contagemStatus[status] || 0) + 1;
          if (status.toLowerCase() === "em andamento") andamento++;
        }
      });

      container.innerHTML += `
        <div class="indicador">
          <div class="titulo">Total de Projetos</div>
          <div class="valor">${totalProjetos}</div>
          <div class="texto">projetos</div>
        </div>
      `;

      Object.entries(contagemStatus).forEach(([status, count]) => {
        container.innerHTML += `
          <div class="indicador">
            <div class="titulo">${status}</div>
            <div class="valor">${count}</div>
            <div class="texto">projetos</div>
          </div>
        `;
      });

      const maiorStatus = Object.entries(contagemStatus).sort((a,b) => b[1] - a[1])[0];
      const percentualStatus = Math.round((maiorStatus[1] / totalProjetos) * 100);
      document.getElementById("labelStatus").innerText = `${percentualStatus}%`;

      new Chart(document.getElementById('graficoStatus'), {
        type: 'doughnut',
        data: {
          labels: [maiorStatus[0], 'Outros'],
          datasets: [{
            data: [maiorStatus[1], totalProjetos - maiorStatus[1]],
            backgroundColor: ['#0078D4', '#E0E0E0']
          }]
        },
        options: {
          cutout: '70%',
          plugins: { legend: { display: false } }
        }
      });

      const percentualAndamento = Math.round((andamento / totalProjetos) * 100);
      document.getElementById("labelAndamento").innerText = `${percentualAndamento}%`;

      new Chart(document.getElementById('graficoAndamento'), {
        type: 'doughnut',
        data: {
          labels: ['Em Andamento', 'Outros'],
          datasets: [{
            data: [andamento, totalProjetos - andamento],
            backgroundColor: ['#34A853', '#E0E0E0']
          }]
        },
        options: {
          cutout: '70%',
          plugins: { legend: { display: false } }
        }
      });

      // üî∑ Indicadores Eurofarma
      const totalSubmetido = data.filter(row =>
        row["Submetido Aconex"]?.trim().toUpperCase() === "SIM"
      ).length;

      const respostas = { "Aprovado": 0, "Revis√£o": 0, "Em An√°lise": 0 };

      data.forEach(row => {
        const resposta = row["Resposta Aconex"]?.trim().toUpperCase();
        if (resposta === "APROVADO") respostas["Aprovado"]++;
        if (resposta === "REVIS√ÉO") respostas["Revis√£o"]++;
        if (resposta === "EM AN√ÅLISE") respostas["Em An√°lise"]++;
      });

      const eurofarmaContainer = document.createElement("div");
      eurofarmaContainer.className = "indicadores";
      eurofarmaContainer.style.marginTop = "40px";

      eurofarmaContainer.innerHTML += `
        <div class="indicador">
          <div class="titulo">Submetido Aconex</div>
          <div class="valor">${totalSubmetido}</div>
          <div class="texto">projetos</div>
        </div>
      `;

      Object.entries(respostas).forEach(([status, count]) => {
        eurofarmaContainer.innerHTML += `
          <div class="indicador">
            <div class="titulo">${status}</div>
            <div class="valor">${count}</div>
            <div class="texto">projetos</div>
          </div>
        `;
      });

      document.querySelector(".painel").appendChild(eurofarmaContainer);
    }

    fetch(planilhaCSV)
      .then(response => response.text())
      .then(csv => {
        Papa.parse(csv, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            processaDados(results.data);
          }
        });
      });

    document.getElementById("arquivoCSV").addEventListener("change", function(e) {
      Papa.parse(e.target.files[0], {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          processaDados(results.data);
        }
      });
    });
  </script>
</body>
</html>
